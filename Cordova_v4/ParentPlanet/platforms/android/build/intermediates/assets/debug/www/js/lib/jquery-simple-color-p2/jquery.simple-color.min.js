(function(e){e.fn.simpleColor=function(t){function i(r){t=e.simpleColorOptions;var i=e("<div class='simpleColorContainer' />");i.css("position","relative");var s=this.value&&this.value!=""?this.value:t.defaultColor;var o=e("<div class='simpleColorDisplay' />");o.css(e.extend(t.displayCSS,{"background-color":s}));o.data("color",s);i.append(o);if(t.displayColorCode){o.data("displayColorCode",true);o.text(this.value);o.css({color:t.colorCodeColor,textAlign:t.colorCodeAlign})}var u=function(r){e("html").bind("click.simpleColorDisplay",function(i){e("html").unbind("click.simpleColorDisplay");e(".simpleColorChooser").hide();var s=e(i.target);if(s.is(".simpleColorCell")===false||e.contains(e(r.target).closest(".simpleColorContainer")[0],s[0])===false){o.css("background-color",o.data("color"));if(t.displayColorCode){o.text(o.data("color"))}}if(t.onClose){t.onClose(n)}});if(r.data.container.chooser){r.data.container.chooser.toggle()}else{var i=e("<div class='simpleColorChooser'/>");i.css(t.chooserCSS);r.data.container.chooser=i;r.data.container.append(i);for(var s=0;s<t.colors.length;s++){var u=e("<div class='simpleColorCell' id='"+t.colors[s]+"'/>");u.css({width:t.cellWidth+"px",height:t.cellHeight+"px",margin:t.cellMargin+"px",cursor:"pointer",lineHeight:t.cellHeight+"px",fontSize:"1px","float":"left","background-color":"#"+t.colors[s]});i.append(u);if(t.onCellEnter||t.livePreview){u.bind("mouseenter",function(e){if(t.onCellEnter){t.onCellEnter(this.id,n)}if(t.livePreview){o.css("background-color","#"+this.id);if(t.displayColorCode){o.text("#"+this.id)}}})}u.bind("click",{input:r.data.input,chooser:i,displayBox:o},function(r){var i="#"+this.id;r.data.input.value=i;e(r.data.input).change();e(r.data.displayBox).data("color",i);r.data.displayBox.css("background-color",i);r.data.chooser.hide();if(t.displayColorCode){r.data.displayBox.text(i)}if(t.onSelect){t.onSelect(this.id,n)}})}}};var a={input:this,container:i,displayBox:o};o.bind("click",a,u);e(this).after(i);e(this).data("container",i)}var n=this;var r=["00CCCC","66CCFF","0033FF","6600CC","CC66FF","FF99FF","FF00CC","FF0000","CC3300","FF6633","996633","66CC00","339900","FFCC00","DAA520 ","666666"];t=e.extend({defaultColor:this.attr("defaultColor")||"#FFF",cellWidth:this.attr("cellWidth")||15,cellHeight:this.attr("cellHeight")||15,cellMargin:this.attr("cellMargin")||1,boxWidth:this.attr("boxWidth")||"115px",boxHeight:this.attr("boxHeight")||"20px",columns:this.attr("columns")||16,insert:this.attr("insert")||"after",colors:this.attr("colors")||r,displayColorCode:this.attr("displayColorCode")||false,colorCodeAlign:this.attr("colorCodeAlign")||"center",colorCodeColor:this.attr("colorCodeColor")||"#FFF",onSelect:null,onCellEnter:null,onClose:null,livePreview:false},t||{});t.totalWidth=t.columns*(t.cellWidth+2*t.cellMargin);t.chooserCSS=e.extend({border:"1px solid #DDD",margin:"0 0 0 5px",width:t.totalWidth,height:t.totalHeight,top:0,left:t.boxWidth,position:"absolute","background-color":"#fff"},t.chooserCSS||{});t.displayCSS=e.extend({"background-color":t.defaultColor,border:"1px solid #000",width:t.boxWidth,height:t.boxHeight,"line-height":t.boxHeight+"px",cursor:"pointer"},t.displayCSS||{});this.hide();if(navigator.userAgent.indexOf("MSIE")!=-1){t.totalWidth+=2}t.totalHeight=Math.ceil(t.colors.length/t.columns)*(t.cellHeight+2*t.cellMargin);e.simpleColorOptions=t;this.each(i);e(".simpleColorDisplay").each(function(){e(this).click(function(e){e.stopPropagation()})});return this};e.fn.closeChooser=function(){this.each(function(t){e(this).data("container").find(".simpleColorChooser").hide()});return this};e.fn.setColor=function(t){this.each(function(n){var r=e(this).data("container").find(".simpleColorDisplay");r.css("background-color",t).data("color",t);if(r.data("displayColorCode")===true){r.text(t)}});return this}})(jQuery)